install.packages("tidyverse")
library(tidyverse)
install.packages("skimr")
library(skimr)
library(readr)
getwd()

rides_2020_04 <- read.csv("202004-divvy-tripdata.csv")
#1
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_05 <- read.csv("202005-divvy-tripdata.csv")
#2
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_06 <- read.csv("202006-divvy-tripdata.csv")
#3
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_07 <- read.csv("202007-divvy-tripdata.csv")
#4
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_08 <- read.csv("202008-divvy-tripdata.csv")
#5
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_09 <- read.csv("202009-divvy-tripdata.csv")
#6
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_10 <- read.csv("202010-divvy-tripdata.csv")
#7
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_11 <- read.csv("202011-divvy-tripdata.csv")
#8
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_double(),
end_station_name = col_character(),
end_station_id = col_double(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2020_12 <- read.csv("202012-divvy-tripdata.csv")
#9
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_character(),
end_station_name = col_character(),
end_station_id = col_character(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2021_01 <- read.csv("202101-divvy-tripdata.csv")
#10
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_character(),
end_station_name = col_character(),
end_station_id = col_character(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)

rides_2021_02 <- read.csv("202102-divvy-tripdata.csv")
#11
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_character(),
end_station_name = col_character(),
end_station_id = col_character(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)
rides_2021_03 <- read.csv("202103-divvy-tripdata.csv")
#12
cols(
ride_id = col_character(),
rideable_type = col_character(),
started_at = col_datetime(format = ""),
ended_at = col_datetime(format = ""),
start_station_name = col_character(),
start_station_id = col_character(),
end_station_name = col_character(),
end_station_id = col_character(),
start_lat = col_double(),
start_lng = col_double(),
end_lat = col_double(),
end_lng = col_double(),
member_casual = col_character()
)
View(rides_2020_04)
View(rides_2020_05)
View(rides_2020_06)
View(rides_2020_07)
View(rides_2020_08)
View(rides_2020_09)
View(rides_2020_10)
View(rides_2020_11)
View(rides_2020_12)
View(rides_2021_01)
View(rides_2021_02)
View(rides_2021_03)

skim(rides_2020_04)
skim(rides_2020_05)
skim(rides_2020_06)
skim(rides_2020_07)
skim(rides_2020_08)
skim(rides_2020_09)
skim(rides_2020_10)
skim(rides_2020_11)
skim(rides_2020_12)
skim(rides_2021_01)
skim(rides_2021_02)
skim(rides_2021_03)


colnames(rides_2020_04)
colnames(rides_2020_05)
colnames(rides_2020_06)
colnames(rides_2020_07)
colnames(rides_2020_08)
colnames(rides_2020_09)
colnames(rides_2020_10)
colnames(rides_2020_11)
colnames(rides_2020_12)
colnames(rides_2021_01)
colnames(rides_2021_02)
colnames(rides_2021_03)
  
rides_2020_12 %>% skimr::skim()

rides_2020_12 <- mutate(rides_2020_12, start_station_id = as.numeric(start_station_id)) #CONVERTING character dta typ to numeric data type
rides_2021_01 <- mutate(rides_2021_01, start_station_id = as.numeric(start_station_id))
rides_2021_02 <- mutate(rides_2021_02, start_station_id = as.numeric(start_station_id))
rides_2021_03 <- mutate(rides_2021_03, start_station_id = as.numeric(start_station_id))
rides_2020_12 <- mutate(rides_2020_12, end_station_id = as.numeric(end_station_id))
rides_2021_01 <- mutate(rides_2021_01, end_station_id = as.numeric(end_station_id))
rides_2021_02 <- mutate(rides_2021_02, end_station_id = as.numeric(end_station_id))
rides_2021_03 <- mutate(rides_2021_03, end_station_id = as.numeric(end_station_id))

rides = bind_rows(rides_2020_04,rides_2020_05,rides_2020_06,rides_2020_07,rides_2020_08,rides_2020_09,
                  rides_2020_10,rides_2020_11,rides_2020_12,rides_2021_01, rides_2021_02,rides_2021_03)
skim(rides)


rides %>% count(member_casual) #counting no.of members and casual customers

library(ggplot2)
rides <-rides %>% drop_na() #removing null values
rides %>% count(member_casual) #rechecking whether null values are dropped or not

library(dplyr)
#rides <- rides %>% mutate(ride_length = ended_at-started_at) %>% mutate(day_of_week = weekdays(started_at))

rides_2020_04 <- mutate(rides_2020_04, ended_at = as.POSIXct(ended_at))
skim(rides_2020_04)
rides_2020_04 <- mutate(rides_2020_04, started_at = as.POSIXct(started_at))
skim(rides_2020_04)


abc= bind_rows(rides_2020_04)
skim(abc)

abc <- abc %>% mutate(ride_length = ended_at-started_at) %>% mutate(day_of_week = weekdays(started_at))

abc %>% select(ride_length,ride_id)

rides <- rides %>% mutate( ended_at = as.POSIXct(ended_at))
skim(rides)
rides <- rides %>% mutate( started_at = as.POSIXct(started_at))
skim(rides)
rides %>% count(member_casual)
rides <- rides %>%
  mutate(ride_length = ended_at-started_at) %>%
  mutate(day_of_week = weekdays(started_at))
rides %>% 
  select(ride_length,started_at,ended_at) %>% 
  filter(ride_length<0) %>%
  arrange((ride_length))
aggregate(rides$ride_length/60 ~ rides$member_casual,FUN=mean)
aggregate(rides$ride_length/3600/24 ~ rides$member_casual, FUN = sum)
aggregate(rides$ride_length ~ rides$member_casual + rides$day_of_week,FUN = mean)

rides$day_of_week <- ordered(rides$day_of_week, levels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
aggregate(rides$ride_length ~ rides$member_casual + rides$day_of_week,FUN = mean)



rides %>% 
  group_by(member_casual, day_of_week) %>%
  summarize(number_of_rides = n()/1000,average_duration = mean(ride_length)) %>%
  arrange(member_casual,day_of_week) %>%
  ggplot(aes(x=day_of_week, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge")+scale_fill_brewer(palette="dark1")+
  labs(y="# of rides in thousands", x="Weekday",caption="Data from April 2020 to March 2021") +
        guides(fill=guide_legend("User type")) + theme_classic()

rides %>%
  sample_n(10000) %>%
  filter(member_casual=="casual") %>%
  ggplot(aes(x=start_lng, y = start_lat, size=ride_length)) +
  geom_point(alpha=.025) + labs(x="Longitude °", y="Latitude °", caption = "Sample of 100k rides from April 2020 to March 2021")
+ ggtitle("Geographical Location of Casual Riders") +scale_fill_brewer(palette="Dark2")+ theme_classic()
